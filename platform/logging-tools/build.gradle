apply plugin: 'java'

dependencies {
	
	implementation commons_lang3
	implementation commons_io
	
	implementation snakeyaml
	implementation ganymed_ssh2
	
	implementation json_20210307
	
	testImplementation junit
}

jar {
	baseName = 'logging-tools'
	version = '0.0.1'
	manifest {
		attributes "Manifest-Version": 1.0,
				'Main-Class': 'cn.gyw.platform.tools.logging.LoggingToolsApplication'
	}
	
	//打包依赖包
	from {
		(configurations.runtimeClasspath).collect {
			it.isDirectory() ? it : zipTree(it)
		}
	}
}

task loggingTools(dependsOn: jar, type: Copy) {
	from(jar.archiveFile)
	into file("$rootDir/output")
}

task copyToRemoteEnv(dependsOn: jar, type: Exec) {
	group = 'XXX'
	description = ''
	workingDir = jar.destinationDirectory
	if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
		def fileName = "${jar.archiveFileName.get()}"
		commandLine 'scp', "-p", "$fileName", "server:home/${fileName}"
	} else {
		commandLine 'sh', '-c', 'mycommand'
	}
}